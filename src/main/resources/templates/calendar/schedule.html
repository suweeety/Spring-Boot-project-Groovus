<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6"
      layout:decorate="~{layout/basic.html}">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ì¼ì •ê´€ë¦¬</title>
    <link th:href="@{/quixlab-bootstrap-main/theme/plugins/fullcalendar/css/fullcalendar.min.css}" rel="stylesheet">
    <link th:href="@{/quixlab-bootstrap-main/theme/plugins/pg-calendar/css/pignose.calendar.min.css}" rel="stylesheet">
    <link th:href="@{/quixlab-bootstrap-main/theme/css/style.css}" rel="stylesheet">

    <!--fonts-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">

    <!--í† í° ë¹„í™œì„±í™”-->
    <!--<meta id="_csrf" name="_csrf" th:content="${_csrf.token}"/>-->
    <!-- default header name is X-CSRF-TOKEN -->
    <!--<meta id="_csrf_header" name="_csrf_header" th:content="${_csrf.headerName}"/>-->
    <script th:src="@{https://code.jquery.com/jquery-3.6.0.min.js}"></script>

    <script th:src="@{/quixlab-bootstrap-main/theme/plugins/common/common.min.js}"></script>
    <script th:src="@{/quixlab-bootstrap-main/theme/js/custom.min.js}"></script>
    <script th:src="@{/quixlab-bootstrap-main/theme/js/settings.js}"></script>
    <script th:src="@{/quixlab-bootstrap-main/theme/js/gleek.js}"></script>
    <script th:src="@{/quixlab-bootstrap-main/theme/js/styleSwitcher.js}"></script>

    <script th:src="@{/quixlab-bootstrap-main/theme/plugins/jqueryui/js/jquery-ui.min.js}"></script>
    <script th:src="@{/quixlab-bootstrap-main/theme/plugins/moment/moment.min.js}"></script>
    <script th:src="@{/quixlab-bootstrap-main/theme/plugins/fullcalendar/js/fullcalendar.min.js}"></script>
    <!--<script th:src="@{/quixlab-bootstrap-main/theme/js/plugins-init/fullcalendar-init.js}"></script>-->

    <th:block layout:fragment="css">

        <style>

            @keyframes vibration {
                from {
                    transform: rotate(1deg);
                }
                to {
                    transform: rotate(-1deg);
                }
            }

            #logoImg{
                background-color: red;
            }
            #deleteInviteMember{
                animation: vibration .1s infinite;
            }

        </style>

    </th:block>

</head>


<th:block layout:fragment="content">

    <input type="button" id="testtest"/>

    <!--**********************************
                Content body start
    ***********************************-->
    <div class="content-body">

        <div class="row page-titles mx-0" style=" transform: translate(10px, -22px);">
            <div class="col p-md-0">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="javascript:void(0)">Project</a></li>
                    <li class="breadcrumb-item active"><a href="javascript:void(0)">Calendar</a></li>
                </ol>
            </div>
        </div>
        <!-- row -->

        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-12">
                    <div class="card" style="transform: translate(-230px, -42px); width: 95rem; height: 95rem;">
                        <div class="card-body">
                            <div class="card-title">
                                <h3>Calendar</h3>
                            </div>
                            <!--Calendar-->
                            <div class="col-md-8" style="height: 38rem;">
                                <div class="card-box m-b-50"
                                     style="width: 70rem; transform: translate(72px, 10px);">
                                    <div id="calendar"></div>
                                </div>
                            </div>
                            <!-- end col -->
                        </div>
                    </div>
                </div>
                <!-- /# card -->
            </div>
            <!-- /# column -->
        </div>
    <!-- #/ container -->
    </div>

    <!-- BEGIN MODAL -->
    <!-- Register Schedule Modal-->
    <div class="modal fade none-border" id="event-modal" th:with="user=${#authentication.principal}">
        <div class="modal-dialog" style="max-width: 48rem; transform: translate(10px, 89px);">
            <div class="modal-content" style="height: auto">
                <div class="modal-header">
                    <h4 class="modal-title"><strong>âœ… ìƒˆ ì¼ì •</strong></h4>
                    <div class="modal-Subtitle" name="create_user_id" style="transform: translate(-4px, 5px);">ì‘ì„±ì: [[${user.uid}]]</div>
                    <p class="text-muted"><code></code></p>
                </div>
                <div id="accordion-two" class="accordion">
                    <div class="modal-body"></div>
                </div>
                <div class="modal-footer" style="transform: translate(10px, -35px);">
                    <button type="button" class="btn btn-default waves-effect"
                            data-dismiss="modal">âœ– Close
                    </button>
                    <button type="button" name="saveBtn"
                            class="btn btn-success save-event waves-effect waves-light" style="background-color: red; border-color: red;">
                        â• ìƒì„±
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Read/Update/Delete Schedule Modal -->
    <div class="modal fade none-border" id="event-modal2" th:with="user=${#authentication.principal}">
        <div class="modal-dialog" style="max-width: 48rem; transform: translate(10px, 89px);">
            <div class="modal-content" style="height: auto">
                <div class="modal-header">
                    <h4 class="modal-title"><strong>ğŸ“… ë‚´ ì¼ì •</strong></h4>
                    <div class="modal-Subtitle" style="transform: translate(-4px, 5px);">
                        ìµœì´ˆ ì‘ì„±ì:
                        [[${user.uid}]]
                        <input type="hidden" name="update_user_id" th:value="${user.uid}" />
                    </div>
                </div>
                <div class="modal-body"></div>
                <div class="modal-footer" style="transform: translate(10px, -35px);">
                    <button type="button" class="btn btn-default waves-effect"
                            data-dismiss="modal">âœ– Close
                    </button>
                    <button type="button" name="modifyBtn"
                            class="btn btn-success" style="background-color: red; border-color: red; display: block">
                        âœ” ë³€ê²½
                    </button>
                    <button type="button" name="deleteBtn"
                            class="btn btn-primary" style="background-color: blueviolet; border-color: red; display: block">
                        â– ì‚­ì œ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!--**********************************
                Content body end
    ***********************************-->

    <!--**********************************
                 Footer start
    ***********************************-->
    <div class="footer">
        <div class="copyright">
            <p>Copyright &copy; Designed & Developed by <a href="https://themeforest.net/user/quixlab">Quixlab</a> 2018
            </p>
        </div>
    </div>
    <!--**********************************
                   Footer end
    ***********************************-->
    </div>
    <!--**********************************
                Main wrapper end
    ***********************************-->

    <!--**********************************
                    Scripts
    ***********************************-->


    <script th:inline="javascript">

        /*--------------------------------------------------------*/
        /*Fields*/
        var uid = [[${#authentication.principal.uid}]];
        var calendarList = [[${calendarList}]];
        var pid = [[${pid}]];
        var cal_id ;
        var cal_attach;

        console.log('calendar:'+calendar);
        console.log('calendarList:'+calendarList);

        /*--------------------------------------------------------*/
        /*cal_idê°’ì„ ê° ì¼ì •ì— ë³´ë‚´ì¤Œ*/
        $(document).on("click","a.fc-day-grid-event",function (e){
            e.preventDefault();
            cal_id = $(this).data("calid");
        })

        /*--------------------------------------------------------*/
        /*ToDoList*/
        $(document).ready(function (){
            $("button[name='addTodoBtn']").on("click", function () {
                var todoInput = $("input[name='dailyTodoInput']").val();

                if (todoInput === null || todoInput === '') {
                    alert("í•  ì¼ì„ ì‘ì„±í•´ ì£¼ì„¸ìš”!");
                } else {
                    // ìƒˆë¡œìš´ í•  ì¼ì„ ê¸°ì¡´ì˜ í•  ì¼ ëª©ë¡ì— ì¶”ê°€
                    var todoItem = "<div><input type='checkbox' name='todoInputList' value='" + todoInput + "'>" + todoInput + "</div>";
                    $(".todo").append(todoItem);

                    // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                    $("input[name='dailyTodoInput']").val('');
                }
            });
        });

        /*ë³€ê²½ ë²„íŠ¼ í´ë¦­*/
        $(document).on("click","button[name='modifyBtn']",function (e){

            e.preventDefault();

            var pidStr = pid+'';
            var cal_idStr = cal_id+'';

            var cal_members = $("input[name='cal_members']").val() ; // value = 'member1,member2,...."
            var cal_title = $("input[name='cal_title']").val();
            var  beginning =  $("input[name='beginning']").val();
            var  ending = $("input[name='ending']").val();
            var   cal_cate = $("select[name='cal_cate'] option:checked").val();
            var   cal_content=  $("input[name='cal_content']").val();
            var   cal_startDate=  $("input[name='cal_startDate']").val();
            var   cal_endDate=  $("input[name='cal_endDate']").val();
            var    cal_attach=  $("input[name='cal_attach']").val();
            var   cal_link_list=  $("input[name='cal_link_list']").val();
            var   update_user_idStr = uid+'';

            $.ajax({
                url: '/calendar/modify',
                method: 'POST',
                data: {
                    'cal_members_str': cal_members,
                    'cal_link_list': cal_link_list,
                    'cal_title': cal_title,
                    'cal_content': cal_content,
                    'cal_cate': cal_cate,
                    'cal_startDate': cal_startDate,
                    'cal_endDate': cal_endDate,
                    'cal_attach': cal_attach,
                    'pid': pidStr,
                    'cal_id': cal_idStr,
                    'update_user_id': update_user_idStr
                },
                success: function (result) {
                    console.log("RESULT: " + result);
                    if (result === 'success') {
                        alert("ì¼ì •ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");
                        console.log("ì¼ì •ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.")
                        $("#event-modal2").hide();
                        location.reload();
                    }
                },
                error: function (xhr, status, error) {
                    alert("ì¼ì • ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                    console.error("ì¼ì • ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:", error);
                }
            });
        })

        /*--------------------------------------------------------*/
        /*ë²„íŠ¼ ëˆŒë¦¼ í™•ì¸*/
        $(document).ready(function() {

            $("button[name='saveBtn']").on("click", function (e){

                e.preventDefault();
            });

            $("button[name='deleteBtn']").on("click", function (e){

                e.preventDefault();
                alert("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
            });
        })

        /*--------------------------------------------------------*/
        /*modal-body(fullcalendar-init.js)*/
        !function (e) {
            "use strict";
            var t = function () {
                this.$body = e("body"),
                    this.$modal = e("#event-modal"),
                    this.$modal2 = e("#event-modal2"),
                    this.$event = "#external-events div.external-event",
                    this.$calendar = e("#calendar"),
                    this.$saveCategoryBtn = e(".save-category"),
                    this.$categoryForm = e("#add-category form"),
                    this.$extEvents = e("#external-events"),
                    this.$calendarObj = null
            };
            t.prototype.onDrop = function (t, n) {
                var a = t.data("eventObject"),
                    o = t.attr("data-class"),
                    i = e.extend({}, a);
                i.start = n, o && (i.className = [o]), this.$calendar.fullCalendar("renderEvent", i, !0), e("#drop-remove").is(":checked") && t.remove()
            },

            /*-------------------------------------------------------*/
            /*Get & Update Schedule*/
            t.prototype.onEventClick = function(t, n, a) {

                var o = this;
                o.$modal2.modal({
                    backdrop: "static"
                });

                $.ajax({
                    url: '/calendar/read/' + pid + '/' + cal_id,
                    type: 'GET',
                    success: async function (response) {

                        var str =  await insertMember(response.cal_members);
                        var str2 = await insertMember2(response.cal_members);

                        console.log("ì¼ì • ë³´ê¸° success.");
                        var i = e("<form name='calendarForm' ></form>");
                        i.append("<input type='hidden' value='cal_id' name='cal_id'/>")
                        i.append("<div class='row' style='height: auto;'></div>"), i.find(".row")
                            .append("<div class='col-md-6' style='border-bottom: #0b0b0b'>" +
                                "<div class='form-group' style='width: 16rem;'>" +
                                "<h5 class='control-label'>ì¼ì • ì œëª©</h5>" +
                                "<input class='form-control'type='text' name='cal_title' value='"+response.cal_title+"' style='width: 16rem; border-top: none;border-left: none;border-right: none;'/>" +
                                "</div>" +
                                "</div>")
                            .append("<div class='col-md-6' style='max-width: 11rem; padding: 0; transform: translate(-90px, 2px);'>" +
                                "<div class='form-group'>" +
                                "<label class='control-label'>ì¹´í…Œê³ ë¦¬</label>" +
                                "<select class='form-control' name='cal_cate' style='width: 9rem; border-radius: 10px;'></select></div></div>").find("select[name='cal_cate']")
                            .append("<option value='"+response.cal_cate+"'>"+response.cal_cate+"</option)")
                            .append("<option value='bg-team'>íŒ€ íšŒì˜</option>")
                            .append("<option value='bg-dept'>ë¶€ì„œ íšŒì˜</option>")
                            .append("<option value='bg-company-event'>ì‚¬ë‚´ í–‰ì‚¬</option>")
                            .append("<option value='bg-personal-event'>ê°œì¸ ì¼ì •</option>")
                            .append("<option value='bg-account-event'>ê±°ë˜ì²˜ ì¼ì •</option>")
                            .append("<option value='bg-business-trip'>ì¶œì¥</option>")
                            .append("<option value='bg-etc'>ê¸°íƒ€</option></div></div>")
                            .end()
                            .append("<div class='userId'>" +
                                "<div class='col-md-6' style='width: 11rem; height: auto; transform: translate(-104px, 2px); padding: 0;'>" +
                                "<div class='form-group' style='margin: 0; height: 5rem;'>" +
                                "<label class='control-label'>ì°¸ì—¬ì</label>" +
                                "<input type='text' class='form-control' name='inviteMember' placeholder='ì´ˆëŒ€ ë©¤ë²„ IDì…ë ¥' id='cal_member_input' style='width: 18rem; border-radius: 10px; display: inline-block' />" +
                                "<span>" +
                                "<button type='button' name='addBtn' style='width: 2rem; height: 36px; transform: translate(251px, -41px); border-radius: 10px; color: gray; background: none; border: none;'>" +
                                "â•</button>" +
                                "</span>" +
                                "</div>" +
                                "<div name='memberTags' style='display: block;width: 11rem;height: 3rem; transform: translate(6px, -76px); position: absolute;left: 35%;top: 4rem;padding: 10px;'>" +
                                  str +
                                "</div>"+
                                "<div class ='col' style='transform: translate(265px, -78px);'>" +
                                "<div class='dropdown custom-dropdown'>" +
                                "<div data-toggle='dropdown'>" +
                                "<i class='fa fa-ellipsis-v'></i>" +
                                "</div>"+
                                "<div class='dropdown-menu dropdown-menu-right' x-placement='bottom-end' style='position: absolute; will-change: transform; top: 15px; transform: translate(0px, -4px); left: 0px; min-width: 7rem; z-index: 20000;' id='dropdownMenu'>" +
                                  str2 +
                                "</div>"+
                                "</div>" +
                                "</div>" +
                                "</div>" +
                                "<input type='hidden' name='create_user_id' value='"+uid+"'>"+
                                "<input type='hidden' name='cal_members' value='"+uid+"'/>"+
                                "</div>")

                            .append("<div class='col-md-6' style='max-width: 46rem; height: 9rem; transform: translate(0px, 15px);'>" +
                                "<div class='form-group' style='margin-top: -1rem;'>" +
                                "<label class='control-label' style='transform: translate(0px, 11px);'>ì¼ì • ë‚´ìš©</label>" +
                                "<input class='form-control' type='textarea' name='cal_content' value='"+response.cal_content+"' style='width: 46rem; height: auto; transform: translate(-1px, 10px); border-radius: 10px;'/></div></div>")
                            .append("<div class='col-md-6' style='transform: translate(0px, 78px);'>" +
                                "<div class='form-group'>" +
                                "<label class='control-label'>ì‹œì‘ ë‚ ì§œ</label>" +
                                "<input class='form-control' type='datetime-local' value='"+response.cal_startDate+"'style='border-radius: 10px;' name='cal_startDate' />" +
                                "</div>"+
                                "<div class='form-group' style='transform: translate(379px, -94px);'>" +
                                "<label class='control-label'>ì¢…ë£Œ ë‚ ì§œ</label>" +
                                "<input class='form-control' type='datetime-local' name='cal_endDate' value='"+response.cal_endDate+"'style='border-radius: 10px;' />" +
                                "</div>" +
                                "</div>")
                            .append("<div class='attach-button' style='transform: translate(10px, 178px); height: 0rem;'>ì²¨ë¶€íŒŒì¼</div>" +
                                "<div class='file-upload-form' style='transform: translate(-46px, 220px); height: 2rem;'>" +
                                "<input type='file' class='custom-file-input files' id='fileInput' name='uploadFiles' multiple value='"+response.cal_attach+"'style='width: 19rem;'/>" +
                                "<button type='submit' class='uploadBtn' style='border: none; background: none;'>" +
                                "<i class='fa-solid fa-link'></i>" +
                                "</button>" +
                                "<div class='uploadResult'>" +
                                "</div>" +
                                "</div>" +
                                "</div>")
                            .append("<div class='col-md-6' style='border-bottom: #0b0b0b; transform: translate(0px, -10px);'>" +
                                "<div class='form-group'>" +
                                "<label class='control-label'>ë§í¬</label>" +
                                "<input class='form-control' type='url' name='cal_link_list' value='"+response.cal_link_list+"'style='border-top: none;border-left: none;border-right: none;'/>" +
                                "</div>" +
                                "</div>")

                            , o.$modal2.find(".delete-event").hide().end()
                                .find(".btn-success").show().end()
                                .find(".modal-body").empty().prepend(i).end()

                        /*-------------------------------------------------------*/
                        /*ì´ˆëŒ€ ë©¤ë²„ ì…ë ¥(ìƒˆë¡œ ì¶”ê°€ë˜ëŠ” ìš©)*/
                        $(document).ready(function() {
                            $("button[name='addBtn']").on("click", function () {

                                var memberInput = $("input[name='inviteMember']").val();
                                if (memberInput === '' || memberInput === null) {
                                    alert("ì¶”ê°€í•  ë©¤ë²„ IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”");
                                } else {
                                    var firstLetter = memberInput.charAt(0); // ì…ë ¥ëœ ë©¤ë²„ IDì˜ ì²« ê¸€ì ì¶”ì¶œ

                                    var calMembersInput = $("input[name='cal_members']");
                                    calMembersInput.val(calMembersInput.val() + "," + memberInput);

                                    // ë©¤ë²„ ì¶”ê°€
                                    var memberBadge = "<span class='badge badge-pill badge-primary'>" + firstLetter + "</span><input type='hidden' name='cal_members' value='" + memberInput + "'/>";

                                    // ì…ë ¥ëœ ë©¤ë²„ë¥¼ dropdown-menuì— ì¶”ê°€
                                    var dropdownItem = $("<a class='dropdown-item' href='#'></a>").text(memberInput);

                                    // ì‚­ì œ ë²„íŠ¼ ì¶”ê°€
                                    var deleteButton = $("<button name='deleteInviteMember' class='deleteInviteMember' type='button' style='width: 20px;background: lightgray;border-radius: 50%;border: none;margin-left: 40px;margin-top: 5px;'>").html("<i class='fa-solid fa-xmark'></i>");
                                    deleteButton.click(function() {

                                        // ë“œë¡­ë‹¤ìš´ ë©”ë‰´ì—ì„œ í•´ë‹¹ ë©¤ë²„ ì œê±°
                                        $("#dropdownMenu").find("a.dropdown-item").filter(function() {
                                            return $(this).text() === memberInput;
                                        }).remove();

                                        // ë©¤ë²„ íƒœê·¸ì—ì„œ í•´ë‹¹ ë©¤ë²„ ì œê±°
                                        $("div[name='memberTags']").find("span").filter(function() {
                                            return $(this).text() === firstLetter;
                                        }).remove();
                                    });

                                    // ì‚­ì œ ë²„íŠ¼ì„ ë©¤ë²„ ì˜†ì— ì¶”ê°€
                                    dropdownItem.append(deleteButton);
                                    // ë“œë¡­ë‹¤ìš´ ë©”ë‰´ì— ë©¤ë²„ ì¶”ê°€
                                    $("#dropdownMenu").append(dropdownItem);

                                    $("div[name='memberTags']").append(memberBadge);

                                    // ì…ë ¥ì°½ ì´ˆê¸°í™”
                                    $("input[name='inviteMember']").val('');
                                }
                            });
                        });

                        /*ì…ë ¥ëœ ë©¤ë²„ ë¦¬ìŠ¤íŠ¸*/
                        $(document).ready(function() {
                            // fa-ellipsis-v ì•„ì´ì½˜ì„ ê°€ì§„ ìš”ì†Œ ì„ íƒ
                            var ellipsisIcon = $(".fa-ellipsis-v");

                            // ì•„ì´ì½˜ì„ í´ë¦­í–ˆì„ ë•Œ ë“œë¡­ë‹¤ìš´ í† ê¸€
                            ellipsisIcon.click(function() {
                                $(this).parent().next('.dropdown-menu').toggleClass('show');
                            });
                        });

                        o.$modal2.find(".btn-success").unbind("click").on("click", function (e) {

                            var pidStr = pid+'';
                            var cal_idStr = cal_id+'';

                            var cal_title = $("input[name='cal_title']").val();
                            var beginning =  $("input[name='beginning']").val();
                            var ending = $("input[name='ending']").val();
                            var cal_cate = $("select[name='cal_cate'] option:checked").val();
                            var cal_content=  $("input[name='cal_content']").val();
                            var cal_startDate=  $("input[name='cal_startDate']").val();
                            var cal_endDate=  $("input[name='cal_endDate']").val();
                            var cal_attach=  $("input[name='cal_attach']").val();
                            var cal_link_list=  $("input[name='cal_link_list']").val();
                            var update_user_idStr = uid+'';
                            var cal_members = $("input[name='cal_members']").val();

                        })
                        /*ì‚­ì œ ë²„íŠ¼ í´ë¦­*/
                        o.$modal2.find(".btn-primary").unbind("click").on("click", function (e) {

                            $.ajax({
                                url: '/calendar/delete/' + pid + '/' + cal_id,
                                method: 'DELETE',
                                success: function (result) {
                                    console.log("RESULT: " + result);
                                    if (result === 'success') {
                                        alert("ì¼ì •ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤..");
                                        console.log("ì¼ì •ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.")
                                        o.$modal.modal("hide")
                                        location.reload();

                                    }
                                },
                                error: function (xhr, status, error) {
                                    alert("ì¼ì • ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                                    console.error("ì¼ì • ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:", error);
                                }
                            })
                        })

                        o.$modal2.find(".cancel-event").show().end()
                            .find(".modal-body").empty().prepend(i).end()
                            .find(".cancel-event").unbind("click").on("click", function () {
                            o.$calendarObj.fullCalendar("removeEvents", function (e) {
                                return e._id == t._id
                            }), o.$modal2.modal("hide")
                        });
                        o.$modal2.modal("hide");

                    },
                    error: function (xhr, status, error) {
                        alert("ì¼ì • ì½ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”");

                    }
                })

                function insertMember(memlist){ // ê¸°ì¡´ cal_members íƒœê·¸ìš©

                    var str ="";

                    for(var member of memlist){
                      str+="<span class='badge badge-pill badge-success' style='margin-right: 5px'>"+member+"</span>";
                    }
                    return str;
                }

                function insertMember2(memlist) { // ê¸°ì¡´ cal_members ë“œë¡­ë‹¤ìš´ìš©
                    var str2 = "";

                    for (var member of memlist) {
                        // dropdown-itemì„ ê°ì‹¸ëŠ” divë¥¼ ë§Œë“­ë‹ˆë‹¤.
                        var dropdownItem = $("<div class='dropdown-item'></div>");

                        // ë©¤ë²„ í…ìŠ¤íŠ¸ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
                        dropdownItem.append("<a href='#'>" + member + "</a>");

                        // ì‚­ì œ ë²„íŠ¼ì„ ìƒì„±í•˜ê³  ì´ë²¤íŠ¸ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
                        var deleteButton = $("<button type='button' class='deleteInviteMember' style='margin-left: 5px;'>X</button>");

                        // ì‚­ì œ ë²„íŠ¼ì„ dropdown-itemì— ì¶”ê°€í•©ë‹ˆë‹¤.
                        dropdownItem.append(deleteButton);

                        // ìƒì„±ëœ dropdown-itemì„ ë¬¸ìì—´ì— ì¶”ê°€í•©ë‹ˆë‹¤.
                        str2 += dropdownItem[0].outerHTML;
                    }

                    // ì‚­ì œ ë²„íŠ¼ì˜ í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë¥¼ í•œ ë²ˆë§Œ ë°”ì¸ë”©í•©ë‹ˆë‹¤.
                    $(document).on("click", ".deleteInviteMember", function() {
                        // í´ë¦­ëœ ë²„íŠ¼ì˜ ë¶€ëª¨ì¸ dropdown-itemì„ ì°¾ì•„ ì œê±°í•©ë‹ˆë‹¤.
                        var parentDropdownItem = $(this).closest('.dropdown-item');
                        parentDropdownItem.remove();

                        // í´ë¦­ëœ ë²„íŠ¼ì´ ì†í•œ dropdown-item ì•ˆì— ìˆëŠ” ë©¤ë²„ë¥¼ ì°¾ì•„ì„œ ì‚­ì œí•©ë‹ˆë‹¤.
                        var memberToRemove = parentDropdownItem.find("a").text();
                        $("div[name='memberTags']").find("span").filter(function() {
                            return $(this).text() === memberToRemove;
                        }).remove();
                    });

                    return str2;
                }

            },
            /*Register schedule*/
            t.prototype.onSelect = function (t, n, a) {
                var firstLetter = uid.charAt(0);
                var o = this;
                o.$modal.modal({
                    backdrop: "static"
                });
                var i = e("<form name='calendarForm' ></form>");
                i.append("<input type='hidden' value='cal_id' name='cal_id'/>")
                i.append("<div class='row' style='height: auto;'></div>"), i.find(".row")
                    .append("<div class='col-md-6' style='border-bottom: #0b0b0b'>" +
                        "<div class='form-group' style='width: 16rem;'>" +
                        "<h5 class='control-label'>ì¼ì • ì œëª©</h5>" +
                        "<input class='form-control' placeholder='Untitled' type='text' name='cal_title' style='width: 16rem; border-top: none;border-left: none;border-right: none;'/>" +
                        "</div>" +
                        "</div>")
                    .append("<div class='col-md-6' style='max-width: 11rem; padding: 0; transform: translate(-90px, 2px);'>" +
                        "<div class='form-group'>" +
                        "<label class='control-label'>ì¹´í…Œê³ ë¦¬</label>" +
                        "<select class='form-control' name='cal_cate' style='width: 9rem; border-radius: 10px;'></select></div></div>").find("select[name='cal_cate']")
                    .append("<option value='bg-team'>íŒ€ íšŒì˜</option>")
                    .append("<option value='bg-dept'>ë¶€ì„œ íšŒì˜</option>")
                    .append("<option value='bg-company-event'>ì‚¬ë‚´ í–‰ì‚¬</option>")
                    .append("<option value='bg-personal-event'>ê°œì¸ ì¼ì •</option>")
                    .append("<option value='bg-account-event'>ê±°ë˜ì²˜ ì¼ì •</option>")
                    .append("<option value='bg-business-trip'>ì¶œì¥</option>")
                    .append("<option value='bg-etc'>ê¸°íƒ€</option></div></div>")
                    .end()
                    .append("<div class='userId'>" +
                        "<div class='col-md-6' style='width: 11rem; height: 5rem; transform: translate(-104px, 2px); padding: 0;'>" +
                        "<div class='form-group' style='margin: 0; height: 5rem;'>" +
                        "<label class='control-label'>ì°¸ì—¬ì</label>" +
                        "<input type='text' class='form-control' name='inviteMember' placeholder='ì´ˆëŒ€ ë©¤ë²„ ì¶”ê°€í•˜ê¸°' id='cal_member_input' style='width: 18rem; border-radius: 10px; display: inline-block' />" +
                        "<span>" +
                        "<button type='button' name='addBtn' style='width: 2rem; height: 36px; transform: translate(251px, -41px); border-radius: 10px; color: gray; background: none; border: none;'>" +
                        "â•</button>" +
                        "</span>" +
                        "</div>" +
                        "<div name='memberTags' style='display: block;width: 11rem;height: 3rem; transform: translate(6px, -76px); position: absolute;left: 35%;top: 4rem;padding: 10px;'>" +
                        "<span class='badge badge-pill badge-success' style='margin-right: 5px'>"+firstLetter+"</span>" +
                        "<input type='hidden' name='cal_members' value='" + uid + "'/>"+
                        "</div>"+
                        "<div class ='col' style='transform: translate(265px, -78px);'>" +
                        "<div class='dropdown custom-dropdown'>" +
                        "<div data-toggle='dropdown'>" +
                        "<i class='fa fa-ellipsis-v'></i>" +
                        "</div>"+
                        "<div class='dropdown-menu dropdown-menu-right' x-placement='bottom-end' style='position: absolute; will-change: transform; top: 15px; transform: translate(0px, -4px); left: 0px; min-width: 7rem; z-index: 20000;' id='dropdownMenu'>" +
                        "<a class='dropdown-item' href='#'>"+uid+"</a>" +
                        "</div>"+
                        "</div>" +
                        "</div>" +
                        "</div>" +
                        "<input type='hidden' name='create_user_id' value='"+uid+"'>"+
                        "<input type='hidden' name='cal_members' value='"+uid+"'/>"+
                        "</div>")

                    .append("<div class='col-md-6' style='max-width: 46rem; height: 9rem; transform: translate(0px, 15px);'>" +
                        "<div class='form-group' style='margin-top: -1rem;'>" +
                        "<label class='control-label' style='transform: translate(0px, 11px);'>ì¼ì • ë‚´ìš©</label>" +
                        "<input class='form-control' placeholder='Contents...' type='textarea' name='cal_content' style='width: 46rem; height: 10rem; transform: translate(-1px, 10px); border-radius: 10px;'/></div></div>")
                    .append("<div class='col-md-6' style='transform: translate(0px, 78px);'>" +
                        "<div class='form-group'>" +
                        "<label class='control-label'>ì‹œì‘ ë‚ ì§œ</label>" +
                        "<input class='form-control' type='datetime-local' style='border-radius: 10px;' name='cal_startDate' />" +
                        "</div>"+
                        "<div class='form-group' style='transform: translate(379px, -94px);'>" +
                        "<label class='control-label'>ì¢…ë£Œ ë‚ ì§œ</label>" +
                        "<input class='form-control' type='datetime-local' name='cal_endDate' style='border-radius: 10px;' />" +
                        "</div>" +
                        "</div>")
                    .append("<div class='attach-button' style='transform: translate(10px, 178px); height: 0rem;'>ì²¨ë¶€íŒŒì¼</div>" +
                        "<div class='file-upload-form' style='transform: translate(-46px, 220px); height: 2rem;'>" +
                        "<input type='file' class='custom-file-input files' id='fileInput' name='uploadFiles' multiple style='width: 19rem;'/>" +
                        "<button type='submit' class='uploadBtn' style='border: none; background: none;'>" +
                        "<i class='fa-solid fa-link'></i>" +
                        "</button>" +
                        "<div class='uploadResult'>" +
                        "</div>" +
                        "</div>" +
                        "</div>")
                    .append("<div class='col-md-6' style='border-bottom: #0b0b0b; transform: translate(0px, -10px);'>" +
                        "<div class='form-group'>" +
                        "<label class='control-label'>ë§í¬</label>" +
                        "<input class='form-control' placeholder='ë§í¬ ì²¨ë¶€(ìµœëŒ€ 1ê°œ)' type='url' name='cal_link_list' style='border-top: none;border-left: none;border-right: none;'/>" +
                        "</div>" +
                        "</div>")

                    , o.$modal.find(".delete-event").hide().end()
                    .find(".save-event").show().end()
                    .find(".modal-body").empty().prepend(i).end()

                /*-------------------------------------------------------*/
                /*ì´ˆëŒ€ ë©¤ë²„ ì…ë ¥*/
                $(document).ready(function() {

                    var memberInputs = '';

                    $("button[name='addBtn']").on("click", function () {
                        var memberInput = $("input[name='inviteMember']").val();

                        if (memberInput === '' || memberInput === null) {
                            alert("ì¶”ê°€í•  ë©¤ë²„ IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”");
                        } else {
                            var firstLetter = memberInput.charAt(0); // ì…ë ¥ëœ ë©¤ë²„ IDì˜ ì²« ê¸€ì ì¶”ì¶œ

                            var calMembersInput = $("input[name='cal_members']");
                            calMembersInput.val(calMembersInput.val() + "," + memberInput);

                            // ë©¤ë²„ ì¶”ê°€
                            memberInputs = "<span class='badge badge-pill badge-primary'>" + firstLetter + "</span>";

                            // ì…ë ¥ëœ ë©¤ë²„ë¥¼ dropdown-menuì— ì¶”ê°€
                            var dropdownItem = $("<a class='dropdown-item' href='#'></a><input type='hidden' name='cal_members' value='" + memberInput + "'/>").text(memberInput);

                            // ì‚­ì œ ë²„íŠ¼ ì¶”ê°€
                            var deleteButton = $("<button name='deleteInviteMember' class='deleteInviteMember' type='button' style='width: 20px;background: lightgray;border-radius: 50%;border: none;margin-left: 40px;margin-top: 5px;'>").html("<i class='fa-solid fa-xmark'></i>");
                            deleteButton.click(function() {

                                var memberToRemove = $(this).prev().text();

                                // ë“œë¡­ë‹¤ìš´ ë©”ë‰´ì—ì„œ í•´ë‹¹ ë©¤ë²„ ì œê±°
                                $("#dropdownMenu").find("a.dropdown-item").filter(function() {
                                    return $(this).text() === memberInput;
                                }).remove();

                                // ë©¤ë²„ íƒœê·¸ì—ì„œ í•´ë‹¹ ë©¤ë²„ ì œê±°
                                $("div[name='memberTags']").find("span").filter(function() {
                                    return $(this).text() === firstLetter;
                                }).remove();
                            });

                            // ì‚­ì œ ë²„íŠ¼ì„ ë©¤ë²„ ì˜†ì— ì¶”ê°€
                            dropdownItem.append(deleteButton);

                            // ë“œë¡­ë‹¤ìš´ ë©”ë‰´ì— ë©¤ë²„ ì¶”ê°€
                            $("#dropdownMenu").append(dropdownItem);

                            $("div[name='memberTags']").append(memberInputs);

                            // ì…ë ¥ì°½ ì´ˆê¸°í™”
                            $("input[name='inviteMember']").val('');
                            memberInputs = '';
                        }
                    });
                });

                /*ì…ë ¥ëœ ë©¤ë²„ ë¦¬ìŠ¤íŠ¸*/
                $(document).ready(function() {
                    // fa-ellipsis-v ì•„ì´ì½˜ì„ ê°€ì§„ ìš”ì†Œ ì„ íƒ
                    var ellipsisIcon = $(".fa-ellipsis-v");

                    // ì•„ì´ì½˜ì„ í´ë¦­í–ˆì„ ë•Œ ë“œë¡­ë‹¤ìš´ í† ê¸€
                    ellipsisIcon.click(function() {
                        $(this).parent().next('.dropdown-menu').toggleClass('show');
                    });
                });

                /*-------------------------------------------------------*/
                /*ì²¨ë¶€íŒŒì¼*/
                $('.uploadBtn').click(function () {

                    var formData = new FormData();

                    var inputFile = $("input[type='file']");

                    var files = inputFile[0].files;

                    for (var i=0; i<files.length; i++) {
                        console.log(files[i]);
                        formData.append("uploadFiles", files[i]);
                    }

                    $.ajax({
                        url: '/uploadAjax',
                        processData: false,
                        contentType: false,
                        data: formData,
                        type: 'POST',
                        dataType: 'json',
                        success: function (result) {
                            console.log(result);
                            showUploadedImages(result);
                        },
                        error: function (jqXHR, textStatus, errorThrown) {
                            console.log(textStatus);
                        }
                    });

                    function showUploadedImages(arr) {

                        console.log(arr);

                        var divArea = $(".uploadResult");

                        var str = "";

                        for(var i=0; i<arr.length; i++) {
                            str += "<div>";
                            str += "<img src='/display?fileName="+arr[i].thumbnailURL+"'>";
                            str += "<button class='removeBtn' data-name='"+arr[i].imageURL+"'>REMOVE</button>"
                            str += "</div>";
                        }
                        divArea.append(str);
                    }
                });

                $(".uploadResult").on("click", ".removeBtn", function (e) {
                    var target = $(this);
                    var fileName = target.data("name");
                    var targetDiv = $(this).closest("div");

                    console.log(fileName);

                    $.post('/removeFile', {fileName: fileName}, function (result) {
                        console.log(result);
                        if(result === true){
                            targetDiv.remove();
                        }
                    })
                })

                // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë“±ë¡
                o.$modal.find(".save-event").unbind("click").on("click", function (e) {

                    e.preventDefault();

                    var pidStr = pid+'';

                    var cal_title = $("input[name='cal_title']").val();
                    var beginning =  $("input[name='beginning']").val();
                    var ending = $("input[name='ending']").val();
                    var cal_cate = $("select[name='cal_cate'] option:checked").val();
                    var cal_content=  $("input[name='cal_content']").val();
                    var cal_startDate=  $("input[name='cal_startDate']").val();
                    var cal_endDate=  $("input[name='cal_endDate']").val();
                    var cal_attach=  $("input[name='cal_attach']").val();
                    var cal_link_list=  $("input[name='cal_link_list']").val();
                    var create_user_id=  $("input[name='create_user_id']").val();
                    var cal_members = $("input[name='cal_members']").val();

                    console.log('cal_title: '+cal_title);
                    console.log('cal_cate: '+cal_cate);
                    console.log('pidStr: '+pidStr);
                    console.log('cal_link_list: '+cal_link_list);
                    console.log('cal_members: '+cal_members)

                    $.ajax({
                        url: '/calendar/register',
                        type: 'post',
                        data: {
                            'cal_members':cal_members,
                            'cal_link_list':cal_link_list,
                            'create_user_id':create_user_id,
                            'cal_attach':cal_attach,
                            'cal_startDate':cal_startDate,
                            'cal_cate':cal_cate,
                            'cal_endDate':cal_endDate,
                            'cal_content':cal_content,
                            'cal_title':cal_title,
                            'pid':pidStr
                        },
                        success: function (response) {
                            if(response == 'success'){
                                alert("ì¼ì •ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
                                console.log("ì¼ì •ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
                                o.$modal.modal("hide")
                                location.reload();
                            }
                        },
                        error: function (xhr, status, error) {
                            alert("ì¼ì • ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
                        }
                    });

                }), o.$modal.find("form").on("submit", function () {
                    var e = i.find("input[name='cal_title']").val(),
                        a = (i.find("select[name='cal_cate']").val(),
                            i.find("input[name='cal_content']").val(),
                            i.find("input[name='cal_startDate']").val(),
                            i.find("input[name='cal_endDate']").val(),
                            i.find("input[name='cal_attach']").val(),
                            i.find("input[name='cal_link_list']").val(),
                            i.find("input[name='create_user_id']").val());
                    return null !== e && 0 != e.length ? (o.$calendarObj.fullCalendar("renderEvent", {
                        title: e,
                        start: t,
                        end: n,
                        allDay: !1,
                        className: a
                    }, !0), o.$modal.modal("hide")) : alert("ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”."), !1
                }), o.$calendarObj.fullCalendar("unselect")
            }, t.prototype.enableDrag = function () { //enableDrag: DOM ìš”ì†Œë“¤ì„ ì„ íƒí•´ì„œ ë“œë˜ê·¸í•˜ëŠ” ê¸°ëŠ¥
                e(this.$event).each(function () {
                    var t = {
                        title: e.trim(e(this).text())
                    };
                    e(this).data("eventObject", t), e(this).draggable({
                        zIndex: 999,
                        revert: !0,
                        revertDuration: 0
                    })
                })
            }, t.prototype.init = function () {

                this.enableDrag();
                var t = new Date,
                    n = (t.getDate(), t.getMonth(), t.getFullYear(), new Date(e.now())),
                    a = [],
                    o = this;

                if(calendarList !== null){
                    for (var i = 0; i < calendarList.length; i++) {

                        var categoryColor = '';
                        // ì¹´í…Œê³ ë¦¬ ê°’ì— ë”°ë¼ ìƒ‰ìƒ ì§€ì •
                        switch (calendarList[i].cal_cate) {
                            case 'íŒ€ íšŒì˜':
                                categoryColor = 'blue'; // íŒŒë€ìƒ‰
                                break;
                            case 'ë¶€ì„œ íšŒì˜':
                                categoryColor = 'pink'; // ë¶„í™ìƒ‰
                                break;
                            case 'ì‚¬ë‚´ í–‰ì‚¬':
                                categoryColor = 'green';
                                break;
                            case 'ê°œì¸ ì¼ì •':
                                categoryColor = 'red';
                                break;
                            case 'ê±°ë˜ì²˜ ì¼ì •':
                                categoryColor = 'purple';
                                break;
                            // ë‹¤ë¥¸ ì¹´í…Œê³ ë¦¬ ê°’ì— ëŒ€í•œ ìƒ‰ìƒë„ ì¶”ê°€ ê°€ëŠ¥
                            default:
                                categoryColor = 'gray'; // ê¸°ë³¸ê°’ (íšŒìƒ‰)
                        }

                        a.push({
                            title: calendarList[i].cal_title+"/"+calendarList[i].cal_id,
                            start: calendarList[i].cal_startDate,
                            end: calendarList[i].cal_endDate,
                            className: calendarList[i].cal_cate,
                            color: categoryColor
                        });
                    }
                }

                o.$calendarObj = o.$calendar.fullCalendar({
                    slotDuration: "00:15:00",
                    minTime: "08:00:00",
                    maxTime: "19:00:00",
                    defaultView: "month",
                    handleWindowResize: !0,
                    height: e(window).height() - 200,
                    header: {
                        left: "prev today next",
                        center: "title",
                        right: "month,agendaWeek,agendaDay"
                    },
                    events: a,
                    editable: !0,
                    droppable: !0,
                    eventLimit: !0,
                    selectable: !0,
                    drop: function (t) {
                        o.onDrop(e(this), t)
                    },
                    select: function (e, t, n) {
                        o.onSelect(e, t, n)
                    },
                    eventClick: function (e, t, n) {
                        o.onEventClick(e, t, n)
                    }
                }), this.$saveCategoryBtn.on("click", function () {
                    var e = o.$categoryForm.find("input[name='category-name']").val(),
                        t = o.$categoryForm.find("select[name='category-color']").val();
                    null !== e && 0 != e.length && (o.$extEvents.append('<div class="external-event bg-' + t + '" data-class="bg-' + t + '" style="position: relative;"><i class="fa fa-move"></i>' + e + "</div>"), o.enableDrag())
                })
            }, e.CalendarApp = new t, e.CalendarApp.Constructor = t
        }(window.jQuery),
            function (e) {
                "use strict";
                e.CalendarApp.init()
            }(window.jQuery);

        /*functionë¶€ë¶„*/
        $(document).ready(function() {

            var linkInputs = '';

            $("button[name='addLinkBtn']").on("click", function () {

                var linkInputField = $("input[name='addLink']");

                if (linkInputField.css('visibility') === 'hidden') {
                    linkInputField.css('visibility', 'visible');
                    linkInputField.focus();
                } else {
                    var linkInput = linkInputField.val();

                    if (linkInput === '' || linkInput === null) {
                        alert("ì¶”ê°€í•  ë§í¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”");
                    } else {
                        linkInputs = "<span class='badge badge-pill badge-primary'>" + linkInput + "</span><button name='deleteLink' type='button' style='border-radius: 50%; background-color: #ebebeb;width: 1rem;' data-calLinkId='" + linkInput + "'><i class='fa-solid fa-xmark'></i></button>" +
                            "<input type='hidden' name='cal_link_list' value='" + linkInput + "'/>";

                        $("div[name='linkTags']").append(linkInputs);
                        linkInputField.val('');
                        linkInputs = '';
                    }
                }
            });
        })

    </script>

</th:block>

</html>